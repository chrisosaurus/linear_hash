TODO:

* consider abstracting calloc calls
* consider allowing a compile option to cause allocs to fail for testing

